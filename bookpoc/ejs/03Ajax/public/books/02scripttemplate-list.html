<!--  Attempt #1 (script tag) at trying to remove unnecessary fetch of in page template.-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ajax Version</title>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th, td {
            padding: 5px;
        }
        a { cursor: pointer; color: blue; }
        a:hover,a.hover { text-decoration: underline; }
    </style>
</head>
<body>
<a href="/logout">Logout</a><br><br>
<div id="display"></div>

<script   src="https://code.jquery.com/jquery-2.2.3.min.js"   integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="   crossorigin="anonymous"></script>
<script src="/scripts/ejs.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        loadBooks();
    });

    function loadBooks(){
        var template = document.getElementById('list');
        var compiled = ejs.compile(template.innerHTML);

        $.get('/api/books/', function(books) {
            var snippet = compiled({books: books});
            document.getElementById('display').innerHTML = snippet;
        });
    }


</script>

<!-- Playing with Mime-types to find an in-page solution that separates javascript and HTML
     Not the purest way, but commonly used and been around for a while.  -->
<script id="list" type="text/x-ejs-template">
    <table>
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Price</th>
        </tr>
        <% books.forEach(function(book) { %>
        <tr id='display<%= book.id %>'>
            <td><%= book.id %></td>
            <td><span><%= book.title %></span></td>
            <td><span><%= book.author %></span></td>
            <td>$<span><%= book.price %></span></td>
        </tr>

        <% }); %>

    </table>

</script>

</body>
</html>